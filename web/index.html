<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BOBN - Camera Control Arcade</title>
    <link rel="stylesheet" href="arcade.css">
</head>
<body>
    <div class="arcade-cabinet">
        <!-- Main Game Area -->
        <div class="main-game-area">
            <!-- Cabinet Header with Title -->
            <div class="cabinet-header">
                <div class="neon-title">
                    <h1 class="game-title">BOBN</h1>
                    <p class="subtitle">SPACE DEFENDER</p>
                </div>
            </div>

            <!-- Main Game Screen Area -->
            <div class="screen-bezel">
                <div class="crt-container">
                    <canvas id="gameCanvas" width="800" height="500" class="game-screen"></canvas>
                    <div class="crt-overlay"></div>
                    <div class="scanlines"></div>
                    <div class="screen-glow"></div>
                </div>
            </div>

            <!-- Status Messages -->
            <div class="status-section">
                <div id="loadingMessage" class="status-message loading">
                    INITIALIZING SYSTEM...
                </div>
                <div id="errorMessage" class="status-message error" style="display: none;"></div>
                <div id="gameMessage" class="status-message game-status" style="display: none;">
                    PRESS START TO PLAY
                </div>
            </div>
        </div>

        <!-- Side Panel -->
        <div class="side-panel">
            <!-- Stats Panel -->
            <div class="stats-panel">
                <div class="stat-display">
                    <div class="stat-label">SCORE</div>
                    <div id="score" class="stat-value">000000</div>
                </div>
                <div class="stat-display">
                    <div class="stat-label">HIGH</div>
                    <div id="highScore" class="stat-value">000000</div>
                </div>
                <div class="stat-display">
                    <div class="stat-label">LIVES</div>
                    <div id="lives" class="stat-value">3</div>
                </div>
                <div class="stat-display">
                    <div class="stat-label">LEVEL</div>
                    <div id="level" class="stat-value">1</div>
                </div>
            </div>

            <!-- Oscilloscope -->
            <div class="oscilloscope-section">
                <div class="oscilloscope-label">HEAD TRACKING</div>
                <div class="oscilloscope-bezel">
                    <canvas id="oscilloscope" width="240" height="120" class="oscilloscope-screen"></canvas>
                    <div class="oscilloscope-overlay"></div>
                </div>
            </div>

            <!-- Control Panel -->
            <div class="control-panel">
                <div class="coin-slot-section">
                    <button id="startBtn" class="arcade-button start-button">
                        <div class="button-top"></div>
                        <span>START<br/>GAME</span>
                    </button>
                </div>

                <div class="instruction-panel">
                    <div class="instructions-title">CONTROLS</div>
                    <div class="control-item">SPACEBAR - FIRE</div>
                    <div class="control-item">ARROWS - MOVE</div>
                    <div class="control-item">ENTER - START</div>
                    <div class="control-item">ESC - PAUSE</div>
                    <div class="control-item">CAMERA - HEAD CONTROL</div>
                </div>
            </div>
        </div>

        <!-- Retro Background Effects -->
        <div class="background-effects">
            <div class="grid-overlay"></div>
            <div class="neon-glow-bg"></div>
        </div>
    </div>

    <script src="wasm_exec.js"></script>
    <script>
        const go = new Go();
        let gameInitialized = false;

        // Game state elements
        const elements = {
            loadingMessage: document.getElementById('loadingMessage'),
            errorMessage: document.getElementById('errorMessage'),
            gameMessage: document.getElementById('gameMessage'),
            scoreDisplay: document.getElementById('score'),
            highScoreDisplay: document.getElementById('highScore'),
            livesDisplay: document.getElementById('lives'),
            levelDisplay: document.getElementById('level'),
            startBtn: document.getElementById('startBtn'),
            oscilloscope: document.getElementById('oscilloscope')
        };

        // Initialize oscilloscope
        function initOscilloscope() {
            const ctx = elements.oscilloscope.getContext('2d');
            ctx.strokeStyle = '#00ff00';
            ctx.lineWidth = 2;

            // Draw initial grid/waveform
            setInterval(() => {
                ctx.clearRect(0, 0, 240, 120);

                // Draw grid
                ctx.strokeStyle = '#003300';
                ctx.lineWidth = 1;
                for (let i = 0; i < 240; i += 24) {
                    ctx.beginPath();
                    ctx.moveTo(i, 0);
                    ctx.lineTo(i, 120);
                    ctx.stroke();
                }
                for (let i = 0; i < 120; i += 20) {
                    ctx.beginPath();
                    ctx.moveTo(0, i);
                    ctx.lineTo(240, i);
                    ctx.stroke();
                }

                // Draw animated waveform
                ctx.strokeStyle = '#00ff00';
                ctx.lineWidth = 2;
                ctx.beginPath();
                for (let x = 0; x < 240; x++) {
                    const y = 60 + Math.sin((x + Date.now() * 0.01) * 0.02) * 20 +
                             Math.sin((x + Date.now() * 0.005) * 0.05) * 15;
                    if (x === 0) ctx.moveTo(x, y);
                    else ctx.lineTo(x, y);
                }
                ctx.stroke();
            }, 50);
        }

        // Start button functionality
        elements.startBtn.addEventListener('click', function() {
            if (gameInitialized) {
                // Visual feedback
                this.style.transform = 'translateY(2px)';
                setTimeout(() => {
                    this.style.transform = '';
                }, 100);

                elements.gameMessage.textContent = 'GAME STARTING...';

                // Simulate Enter key press to start game
                const enterEvent = new KeyboardEvent('keydown', {
                    key: 'Enter',
                    code: 'Enter',
                    keyCode: 13
                });
                document.dispatchEvent(enterEvent);
            }
        });

        async function loadWasm() {
            try {
                elements.loadingMessage.textContent = 'LOADING WASM MODULE...';

                const result = await WebAssembly.instantiateStreaming(fetch("main.wasm"), go.importObject);

                elements.loadingMessage.textContent = 'WASM MODULE LOADED! INITIALIZING...';

                go.run(result.instance);

                // Game initialization complete
                gameInitialized = true;
                elements.loadingMessage.style.display = 'none';
                elements.gameMessage.style.display = 'block';
                elements.gameMessage.textContent = 'PRESS START TO PLAY';

            } catch (err) {
                console.error('Failed to load WASM:', err);
                elements.loadingMessage.style.display = 'none';
                elements.errorMessage.style.display = 'block';
                elements.errorMessage.textContent = 'SYSTEM ERROR: ' + err.message;
            }
        }

        // Initialize when ready
        if (document.readyState === 'complete' || document.readyState === 'interactive') {
            initOscilloscope();
            loadWasm();
        } else {
            document.addEventListener('DOMContentLoaded', () => {
                initOscilloscope();
                loadWasm();
            });
        }
    </script>
</body>
</html>